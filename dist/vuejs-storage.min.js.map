{"version":3,"file":"vuejs-storage.min.js","sources":["../src/objpath.ts","../src/drivers.ts","../src/merge.ts","../src/install.ts","../src/index.ts","../src/vuexplugin.ts"],"sourcesContent":["export function parsePath(path: string): string[] {\n\treturn path\n\t\t.replace(/\\[([^[\\]]*)\\]/g, '.$1.')\n\t\t.split('.')\n\t\t.filter(t => t !== '')\n}\nexport function get(obj: object, path: string): any {\n\treturn parsePath(path).reduce((prev, cur) => prev && prev[cur], obj)\n}\nexport function set(obj: object, path: string, value: any): void {\n\tconst paths = parsePath(path)\n\tlet cur = obj\n\tfor (let i = 0; i < paths.length - 1; i++) {\n\t\tconst pname = paths[i]\n\t\tif (!cur.hasOwnProperty(pname)) cur[pname] = {}\n\t\tcur = cur[pname]\n\t}\n\tcur[paths[paths.length - 1]] = value\n}\nexport function copy(dest: object, source: object, path: string): void {\n\tset(dest, path, get(source, path))\n}\n","import { StorageDriver } from './interfaces'\nexport default class StroageDriverImpl implements StorageDriver {\n\tprivate storage\n\tconstructor(storage: Storage) {\n\t\tthis.storage = storage\n\t}\n\tset(key: string, value: any) {\n\t\tthis.storage.setItem(key, JSON.stringify(value))\n\t}\n\tget(key: string) {\n\t\treturn JSON.parse(this.storage.getItem(key))\n\t}\n\thas(key: string) {\n\t\treturn !!this.storage.getItem(key)\n\t}\n}\nexport const localStorage = new StroageDriverImpl(window.localStorage)\nexport const sessionStorage = new StroageDriverImpl(window.sessionStorage)\n","// a simple object merge function implementation\nexport const isobj = x => typeof x === 'object' && !Array.isArray(x) && x !== null\nconst merge = (target, source) => {\n\tfor (const key of Object.keys(source)) {\n\t\tif (isobj(source[key])) {\n\t\t\tif (!(key in target)) {\n\t\t\t\ttarget[key] = source[key]\n\t\t\t} else {\n\t\t\t\tmerge(target[key], source[key])\n\t\t\t}\n\t\t} else {\n\t\t\ttarget[key] = source[key]\n\t\t}\n\t}\n\treturn target\n}\nexport default merge\n","import { Vue, VueConstructor, Option } from './interfaces'\nimport { set, copy } from './objpath'\nimport { localStorage } from './drivers'\nimport defaultMerge from './merge'\n\nfunction applyPersistence(vm, option: Option) {\n\tconst { keys, merge = defaultMerge, namespace: ns, driver = localStorage } = option\n\n\tlet originaldata = {}\n\tfor (const k of keys) {\n\t\tcopy(originaldata, vm, k)\n\t}\n\n\tlet data = null\n\tif (driver.has(ns)) {\n\t\tdata = driver.get(ns)\n\t} else {\n\t\tconst tmp = {}\n\t\tfor (const k of keys) {\n\t\t\tcopy(tmp, originaldata, k)\n\t\t}\n\t\tdata = tmp\n\t\tdriver.set(ns, data)\n\t}\n\tdata = merge(originaldata, data)\n\tfor (const k of keys) {\n\t\tcopy(vm, data, k)\n\t\tvm.$watch(k, {\n\t\t\thandler: value => {\n\t\t\t\tset(data, k, value)\n\t\t\t\tdriver.set(ns, data)\n\t\t\t},\n\t\t\tdeep: true\n\t\t})\n\t}\n}\n\nexport function install(Vue: VueConstructor) {\n\tVue.mixin({\n\t\tcreated() {\n\t\t\tfunction cloneOptions(options: Option, ref: any) {\n\t\t\t\tconst clonedOptions: Option = {\n\t\t\t\t\tkeys: [],\n\t\t\t\t\tnamespace: ''\n\t\t\t\t}\n\t\t\t\tfor (var prop in options) {\n\t\t\t\t\tif (options.hasOwnProperty(prop)) {\n\t\t\t\t\t\tif (prop === 'namespaceFactory') {\n\t\t\t\t\t\t\tclonedOptions['namespace'] = options[prop](ref)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclonedOptions[prop] = options[prop]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn clonedOptions\n\t\t\t}\n\t\t\tif ('storage' in this.$options) {\n\t\t\t\tconst options: Option | Option[] = this.$options.storage\n\t\t\t\tif (Array.isArray(options)) options.forEach(opt => applyPersistence(this, cloneOptions(opt, this)))\n\t\t\t\telse applyPersistence(this, cloneOptions(options, this))\n\t\t\t}\n\t\t}\n\t})\n}\n","import { Vue, VueConstructor, VuexPlugin, StorageDriver } from './interfaces'\n\nimport { install } from './install'\nimport { createVuexPlugin } from './vuexplugin'\nimport * as drivers from './drivers'\n\nexport interface vjs {\n\t(): VuexPlugin<Object>\n\tinstall: (Vue: VueConstructor) => void\n\tdrivers: { localStorage: StorageDriver; sessionStorage: StorageDriver }\n}\nconst vuejsStorage = <vjs>function(option) {\n\treturn createVuexPlugin(option)\n}\nvuejsStorage.install = install\nvuejsStorage.drivers = drivers\n\nexport default vuejsStorage\n","import { Store, VuexPlugin, Option } from './interfaces'\nimport { copy } from './objpath'\nimport { localStorage } from './drivers'\nimport defaultMerge from './merge'\n\n/**\n * Create Vuex plugin\n */\nexport function createVuexPlugin(option: Option): VuexPlugin<object> {\n\tconst { keys, merge = defaultMerge, namespace: ns, driver = localStorage } = option\n\treturn (store: Store<object>) => {\n\t\tif (driver.has(ns)) {\n\t\t\tconst data = driver.get(ns)\n\t\t\tstore.replaceState(merge(store.state, data))\n\t\t} else {\n\t\t\tconst data = {}\n\t\t\tfor (const k of keys) {\n\t\t\t\tcopy(data, store.state, k)\n\t\t\t}\n\t\t\tdriver.set(ns, data)\n\t\t}\n\t\tstore.subscribe((mutation, state) => {\n\t\t\tconst data = {}\n\t\t\tfor (const k of keys) {\n\t\t\t\tcopy(data, state, k)\n\t\t\t}\n\t\t\tdriver.set(ns, data)\n\t\t})\n\t}\n}\n"],"names":["parsePath","path","replace","split","filter","t","set","obj","value","paths","cur","i","length","pname","hasOwnProperty","copy","dest","source","reduce","prev","get","storage","this","StroageDriverImpl","key","setItem","JSON","stringify","parse","getItem","localStorage","window","sessionStorage","merge","target","_a","Object","keys","_i","x","Array","isArray","applyPersistence","vm","option","ns","_b","driver","originaldata","keys_1","k","data","has","tmp","keys_2","_c","$watch","handler","deep","keys_3","_d","vuejsStorage","store","replaceState","state","subscribe","mutation","createVuexPlugin","install","Vue","mixin","created","cloneOptions","options","ref","clonedOptions","namespace","prop","$options","forEach","opt","_this","drivers"],"mappings":"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"}